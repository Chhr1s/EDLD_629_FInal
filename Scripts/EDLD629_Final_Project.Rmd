---
title: "Final Project"
author: "Christopher Loan"
date: "5/24/2021"
output: html_document
---

Definitely:

o	number of level 1 units, 
o	number of level 2 units, 
o	magnitude of interaction effect, 
o	comparing these models to the equivalent model in lmer/nlme that doesnâ€™t look for parameter instability

Maybe:

o	cross-level interaction vs. same-level interaction, (probably lower power for cross level)
o	ICC, 
o	continuous vs. categorical interaction terms, 
o	number of level 3 units,
o	nested vs. cross-classified designs, 
o	continuous vs. categorical outcomes, 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
## https://benwhalley.github.io/just-enough-r/power-analysis.html
```

```{r}
library(tidyverse)
library(lme4)
#library(equatiomatic)
#library(sundry)
library(glmertree)
#library(simr)
library(dials)
source(here::here('Scripts', 'functions_EDLD629_Final.R'))
```

```{r}
ns_param <- 
  new_quant_param(
    type = "integer",
    range = c(20, 100),
    inclusive = c(TRUE, TRUE),
    trans = NULL,
    label = c(ns_param = "number of level 1 units"),
    finalize = NULL
  )

js_param <- 
  new_quant_param(
    type = "integer",
    range = c(4, 10),
    inclusive = c(TRUE, TRUE),
    trans = NULL,
    label = c(js_param = "number of level 2 units"),
    finalize = NULL
  )

# intx_param <- 
#   new_quant_param(
#     type = "integer",
#     range = c(-3, 3),
#     inclusive = c(TRUE, TRUE),
#     trans = NULL,
#     label = c(intx_param = "interaction values"),
#     finalize = NULL
#   )
```

```{r}
parameter_grid <- 
  grid_max_entropy(
  ns_param, 
  js_param, 
  size = 8,
  original = FALSE)
```

```{r}
intx_values <- c(-2, -1, 0, 1, 2)

intx_value <- 2.00

sim_dat <-
  pmap(
    list(
      parameter_grid$ns_param, 
      parameter_grid$js_param
      #parameter_grid$intx_param
      ), 
    ~simulate_two_level_interaction(
      n = ..1, 
      j = ..2, 
      intercept_lv1 = 10.00, 
      interaction = intx_value,
      main_x = 1.25, 
      main_z = 1.00,
      residual_var_sd_lv1 = 6.00,
      random_int_mean_lv2 = 5, 
      random_int_sd_lv2 = 2.00, 
      start_seed = 123
      )
  )
```

```{r}
test <- compare_mods(sim_dat, 2.00)
```


